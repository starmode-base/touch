---
alwaysApply: false
---

# Goal

Synchronize with the template while being considerate of local edits.

# Variables

- templateRepo: https://github.com/starmode-base/template-tanstack-start
- lastSyncedSHA: "fc1cf63052d46cf9c19fd128cd2d785279b855c7"

# Constraints

- Do not run git in this repo; use a temp clone of {{templateRepo}} only.

# Output requirements

- Immediately before step 1 of `# Procedure`, output the chosen CASE on its own line. Use exactly one of the following strings:
  - Selected CASE: Case A - Already up to date
  - Selected CASE: Case B - Initial sync
  - Selected CASE: Case C - Incremental sync
- Optionally add a second line starting with `Reason:` explaining the decision.
- Do not print placeholder choices (e.g., with pipes) or any alternative format.

# Procedure

1. Identify SHAs
   - NEW = {{templateRepo}} default-branch HEAD
   - BASE = {{lastSyncedSHA}} (empty means unknown/initial)

2. Case A: Already up to date
   - If BASE == NEW → stop

3. Case B: Initial sync (BASE unknown)
   - Handle evident renames/moves, then add any missing files from {{templateRepo}}.
   - Best-effort merge NEW into local, keeping clear local edits.

4. Case C: Incremental sync (BASE known)
   - Compute {{templateRepo}} diff BASE → NEW (track renames)
   - Apply template adds/modifies/deletes/renames
   - For files changed locally since BASE, perform a 3-way merge (BASE vs NEW vs local); on conflicts, perform a best-effort merge keeping local edits

5. Finalize
   - Summarize applied changes
   - Update `lastSyncedSHA` to NEW
